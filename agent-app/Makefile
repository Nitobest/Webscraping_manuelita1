.PHONY: help setup install run dev test clean lint format docs

# Variables
PYTHON := python3
PIP := pip
UV := uv

help:
	@echo "=================================="
	@echo "Agent-App Makefile Commands"
	@echo "=================================="
	@echo "setup           - Instalar dependencias con UV"
	@echo "install         - Instalar con pip"
	@echo "run             - Ejecutar aplicaciÃ³n Streamlit"
	@echo "dev             - Ejecutar en modo desarrollo"
	@echo "test            - Ejecutar tests"
	@echo "lint            - Ejecutar linter"
	@echo "format          - Formatear cÃ³digo"
	@echo "clean           - Limpiar archivos temporales"
	@echo "generate-faq    - Generar FAQ JSON desde markdown"
	@echo "help            - Mostrar esta ayuda"

setup:
	@echo "Instalando dependencias con UV..."
	$(UV) sync
	@echo "âœ… Setup completado"

install:
	@echo "Instalando dependencias con pip..."
	$(PIP) install -e ".[dev]"
	@echo "âœ… InstalaciÃ³n completada"

run:
	@echo "ğŸš€ Iniciando aplicaciÃ³n Streamlit..."
	streamlit run app.py

dev:
	@echo "ğŸ”§ Modo desarrollo - Hot reload activo..."
	streamlit run app.py --logger.level=debug

test:
	@echo "ğŸ§ª Ejecutando tests..."
	$(PYTHON) -m pytest tests/ -v --cov=. --cov-report=html
	@echo "âœ… Tests completados. Reporte HTML en htmlcov/"

lint:
	@echo "ğŸ” Ejecutando linter..."
	flake8 . --exclude=venv,.venv
	@echo "âœ… Lint completado"

format:
	@echo "ğŸ¨ Formateando cÃ³digo..."
	black . --exclude=venv,.venv
	@echo "âœ… Formato completado"

clean:
	@echo "ğŸ§¹ Limpiando archivos temporales..."
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name ".mypy_cache" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name "htmlcov" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name ".coverage" -delete
	@echo "âœ… Limpieza completada"

generate-faq:
	@echo "ğŸ”„ Generando FAQ JSON desde markdown..."
	$(PYTHON) parser.py
	@echo "âœ… FAQ JSON generado en tools/data/faq_structured.json"

# Alias Ãºtiles
.PHONY: test-quick
test-quick:
	$(PYTHON) -m pytest tests/ -v --tb=short

.PHONY: docker-build
docker-build:
	@echo "ğŸ³ Construyendo imagen Docker..."
	docker build -t agent-app:latest .

.PHONY: docker-run
docker-run:
	@echo "ğŸ³ Ejecutando en Docker..."
	docker run -p 8501:8501 agent-app:latest

.DEFAULT_GOAL := help
